<!-- templates/feedback_form.html -->
{% extends "base.html" %}
{% block title %}{{ t('feedback') }} - {{ ticket.code }}{% endblock %}

{% block content %}
<div class="max-w-md mx-auto">
    <div class="bg-white rounded-lg shadow-lg p-8">
        <h1 class="text-2xl font-bold text-center mb-6 text-gray-800">
            ‚≠ê {{ t('rate_service') }}
        </h1>

        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
            <h3 class="font-semibold text-green-800 mb-2">{{ t('your_sharpening') }}:</h3>
            <div class="text-sm space-y-1">
                <div><strong>{{ t('ticket_code') }}:</strong> {{ ticket.code }}</div>
                <div><strong>{{ t('skates') }}:</strong> {{ ticket.brand }} {{ ticket.color }} {{ ticket.size }}</div>
                <div><strong>{{ t('sharpened_by') }}:</strong> {{ ticket.sharpener.name if ticket.sharpener else t('unknown') }}</div>
                <div><strong>{{ t('completed_at') }}:</strong> {{ ticket.completed_at.strftime('%d/%m %H:%M') if ticket.completed_at else t('unknown') }}</div>
            </div>
        </div>

        <form action="{{ url_for('feedback', ticket_code=ticket.code) }}" method="POST" class="space-y-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-4 text-center">
                    {{ t('rate_service') }} *
                </label>
                <div class="flex justify-center space-x-2">
                    {% for i in range(1, 6) %}
                        <label class="cursor-pointer">
                            <input type="radio" name="rating" value="{{ i }}" required class="sr-only">
                            <span class="star text-3xl text-gray-300 hover:text-yellow-400 transition-colors" data-rating="{{ i }}">‚≠ê</span>
                        </label>
                    {% endfor %}
                </div>
                <div class="text-center text-sm text-gray-500 mt-2">
                    <span id="rating-text">{{ t('click_to_rate') }}</span>
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    {{ t('comment') }} (optional)
                </label>
                <textarea name="comment" rows="3"
                          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                          placeholder="{{ t('comment_placeholder_sharpener') }}"></textarea>
            </div>

            <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-lg">
                {{ t('submit_feedback') }}
            </button>
        </form>
    </div>
</div>

<script>
const stars = document.querySelectorAll('.star');
const ratingText = document.getElementById('rating-text');
const ratings = ['', 'D√•rlig üòû', 'OK üòê', 'God üôÇ', 'Rigtig god üòä', 'Fremragende! ü§©'];

stars.forEach((star, index) => {
    star.addEventListener('click', () => {
        const rating = index + 1;

        // Update radio button
        document.querySelector(`input[value="${rating}"]`).checked = true;

        // Update visual stars
        stars.forEach((s, i) => {
            s.style.color = i < rating ? '#fbbf24' : '#d1d5db';
        });

        // Update text
        ratingText.textContent = ratings[rating];
    });

    star.addEventListener('mouseover', () => {
        const rating = index + 1;
        stars.forEach((s, i) => {
            s.style.color = i < rating ? '#fbbf24' : '#d1d5db';
        });
        ratingText.textContent = ratings[rating];
    });
});

document.querySelector('form').addEventListener('mouseleave', () => {
    const checked = document.querySelector('input[name="rating"]:checked');
    if (checked) {
        const rating = parseInt(checked.value);
        stars.forEach((s, i) => {
            s.style.color = i < rating ? '#fbbf24' : '#d1d5db';
        });
        ratingText.textContent = ratings[rating];
    } else {
        stars.forEach(s => s.style.color = '#d1d5db');
        ratingText.textContent = 'Klik for at bed√∏mme';
    }
});
</script>
{% endblock %}
